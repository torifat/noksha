#!/usr/bin/env node
require('shelljs/global');
require('js-yaml');
require('colors');

var version = '0.0.1';
var config = 'blueprint';

// Requires git, curl
['git', 'curl'].forEach(function(dep) {
    if(!which(dep)) {
        console.log(('Sorry, this script requires ' + dep).red);
        exit(1);
    }
});

console.log(('noksha v' + version).blue.inverse);

try {
    var deps = require(pwd() + '/' + config + '.yml');
} catch (err) {
    switch(err.code) {
        case 'MODULE_NOT_FOUND':
            console.log(('Error - No ' + config + '.yml found on the current directory').red);
            break;
        default:
            console.log(('Check your ' + config + '.yml').red);
    }
    exit(1);
}
for(var name in deps) {
    console.log(('Processing ' + name).blue);
    var dep = deps[name];
    if(dep) {
        // Prefer git over web as a source
        // Git
        if(dep.hasOwnProperty('git')) {
            console.log('Using git repo as source');
        }
        // Web
        else if(dep.hasOwnProperty('web')) {
            console.log('Using web as source');
        } else {
            console.log('Invalid rule'.red);
        }
    } else {
        console.log(('Invalid rule for ' + name.inverse).red);
    }
}